# Hyprland config - migrated from i3
#plugin = /etc/hyprland/plugins/libinputactions_hyprland.so

###################
### MONITORS ###
###################

# HDMI-A-1 (左) | eDP-1 (右)
monitor = HDMI-A-1, preferred, auto-right, auto
monitor = eDP-1, preferred, auto-left, auto
monitor = , preferred, auto, auto  # フォールバック（その他のモニター用）
#source = ./monitors.conf

# Workspace-monitor bindings
workspace = 1, monitor:HDMI-A-1, default:true
workspace = 2, monitor:HDMI-A-1
workspace = 3, monitor:HDMI-A-1
workspace = 4, monitor:HDMI-A-1
workspace = 5, monitor:HDMI-A-1
workspace = 6, monitor:HDMI-A-1
workspace = 7, monitor:HDMI-A-1
workspace = 8, monitor:HDMI-A-1
workspace = 9, monitor:eDP-1, default:true
workspace = 10, monitor:eDP-1


###################
### XWAYLAND ###
###################

xwayland {
  force_zero_scaling = true
}


###################
### PROGRAMS ###
###################

$terminal = alacritty
$fileManager = thunar
$menu = rofi -show drun
$browser = zen


###################
### AUTOSTART ###
###################

# Daemons
exec-once = dbus-update-activation-target --systemd --all; systemctl --user start hyprland-session.target

# Plugins
exec-once = hyprctl plugin load "$HYPR_PLUGIN_DIR/libinputactions_hyprland.so"

exec-once = waybar
exec-once = thunar --daemon
exec-once = dex -a

# Clipboard history
exec-once = clipse -listen

# Configurations
exec-once = dconf write /org/gnome/desktop/interface/gtk-key-theme "'Emacs'"
exec-once = wlsunset -l 35.6 -L 139.8

# Wallpaper - using native Hyprland background_color in misc section

# Services (adjust for NixOS systemd user services)
exec-once = systemctl --user start xremap
exec-once = systemctl --user start yaskkserv2

# hyprtag - Tag based window management (dwm-style)
exec-once = hyprtag


#############################
### ENVIRONMENT VARIABLES ###
#############################

env = HYPRCURSOR_THEME,rose-pine-hyprcursor
env = XCURSOR_THEME,Adwaita
env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE,24

# XWayland HiDPI (force_zero_scaling用)
env = GDK_SCALE,2
env = QT_SCALE_FACTOR,2

# IM
env = GTK_IM_MODULE,fcitx
env = QT_IM_MODULE,fcitx
env = XMODIFIERS,@im=fcitx
env = SDL_IM_MODULE,fcitx
env = GLFW_IM_MODULE,ibus

#####################
### LOOK AND FEEL ###
#####################

general {
    gaps_in = 5
    gaps_out = 10
    border_size = 2

    # Colors from i3 config
    col.active_border = rgba(2e9ef4ff)
    col.inactive_border = rgba(222222ff)

    resize_on_border = true
    allow_tearing = false
    layout = dwindle
}

decoration {
    rounding = 0

    active_opacity = 1.0
    inactive_opacity = 1.0

    shadow {
        enabled = false
    }

    blur {
        enabled = false
    }
}

animations {
    enabled = yes

    # Default curves, see https://wiki.hypr.land/Configuring/Animations/#curves
    #        NAME,           X0,   Y0,   X1,   Y1
    bezier = easeOutQuint,   0.23, 1,    0.32, 1
    bezier = easeInOutCubic, 0.65, 0.05, 0.36, 1
    bezier = linear,         0,    0,    1,    1
    bezier = almostLinear,   0.5,  0.5,  0.75, 1
    bezier = quick,          0.15, 0,    0.1,  1

    # Default animations, see https://wiki.hypr.land/Configuring/Animations/
    #           NAME,          ONOFF, SPEED, CURVE,        [STYLE]
    animation = global,        1,     10,    default
    animation = border,        1,     5.39,  easeOutQuint
    animation = windows,       1,     4.79,  easeOutQuint
    animation = windowsIn,     1,     4.1,   easeOutQuint, popin 87%
    animation = windowsOut,    1,     1.49,  linear,       popin 87%
    animation = fadeIn,        1,     1.73,  almostLinear
    animation = fadeOut,       1,     1.46,  almostLinear
    animation = fade,          1,     3.03,  quick
    animation = layers,        1,     3.81,  easeOutQuint
    animation = layersIn,      1,     4,     easeOutQuint, fade
    animation = layersOut,     1,     1.5,   linear,       fade
    animation = fadeLayersIn,  1,     1.79,  almostLinear
    animation = fadeLayersOut, 1,     1.39,  almostLinear
    animation = workspaces,    0,     1.94,  almostLinear, fade
    animation = workspacesIn,  0,     1.21,  almostLinear, fade
    animation = workspacesOut, 0,     1.94,  almostLinear, fade
    animation = zoomFactor,    1,     7,     quick
}

dwindle {
    pseudotile = true
    preserve_split = true
}

misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
    background_color = rgb(c79081)
}


#############
### INPUT ###
#############

input {
    kb_layout = us
    kb_options = ctrl:nocaps

    repeat_delay = 200
    repeat_rate = 99

    # focus_follows_mouse no
    follow_mouse = 0

    natural_scroll = true
}


####################
### KEYBINDINGS ###
####################

$mainMod = SUPER

# Core
bindd = $mainMod, Return, Terminal, exec, $terminal
bindd = $mainMod SHIFT, Q, Close window, killactive
bindd = $mainMod, D, App launcher, exec, $menu
bindd = $mainMod, Y, File manager, exec, $fileManager

# Focus (vim style)
bind = $mainMod, H, movefocus, l
bind = $mainMod, J, movefocus, d
bind = $mainMod, K, movefocus, u
bind = $mainMod, L, movefocus, r

# Focus (arrow keys)
bind = $mainMod, Left, movefocus, l
bind = $mainMod, Down, movefocus, d
bind = $mainMod, Up, movefocus, u
bind = $mainMod, Right, movefocus, r

# Move window (vim style)
bind = $mainMod SHIFT, H, movewindow, l
bind = $mainMod SHIFT, J, movewindow, d
bind = $mainMod SHIFT, K, movewindow, u
bind = $mainMod SHIFT, L, movewindow, r

# Move window (arrow keys)
bind = $mainMod SHIFT, Left, movewindow, l
bind = $mainMod SHIFT, Down, movewindow, d
bind = $mainMod SHIFT, Up, movewindow, u
bind = $mainMod SHIFT, Right, movewindow, r

# hyprtag - Tag based window management (dwm-style)
# Show tag (switch to tag)
bind = $mainMod, 1, exec, hyprtagctl show 1
bind = $mainMod, 2, exec, hyprtagctl show 2
bind = $mainMod, 3, exec, hyprtagctl show 3
bind = $mainMod, 4, exec, hyprtagctl show 4
bind = $mainMod, 5, exec, hyprtagctl show 5
bind = $mainMod, 6, exec, hyprtagctl show 6
bind = $mainMod, 7, exec, hyprtagctl show 7
bind = $mainMod, 8, exec, hyprtagctl show 8
bind = $mainMod, 9, exec, hyprtagctl show 9

# Move window to tag
bind = $mainMod SHIFT, 1, exec, hyprtagctl move 1
bind = $mainMod SHIFT, 2, exec, hyprtagctl move 2
bind = $mainMod SHIFT, 3, exec, hyprtagctl move 3
bind = $mainMod SHIFT, 4, exec, hyprtagctl move 4
bind = $mainMod SHIFT, 5, exec, hyprtagctl move 5
bind = $mainMod SHIFT, 6, exec, hyprtagctl move 6
bind = $mainMod SHIFT, 7, exec, hyprtagctl move 7
bind = $mainMod SHIFT, 8, exec, hyprtagctl move 8
bind = $mainMod SHIFT, 9, exec, hyprtagctl move 9

# Toggle tag (show multiple tags simultaneously)
bind = $mainMod CTRL, 1, exec, hyprtagctl toggle 1
bind = $mainMod CTRL, 2, exec, hyprtagctl toggle 2
bind = $mainMod CTRL, 3, exec, hyprtagctl toggle 3
bind = $mainMod CTRL, 4, exec, hyprtagctl toggle 4
bind = $mainMod CTRL, 5, exec, hyprtagctl toggle 5
bind = $mainMod CTRL, 6, exec, hyprtagctl toggle 6
bind = $mainMod CTRL, 7, exec, hyprtagctl toggle 7
bind = $mainMod CTRL, 8, exec, hyprtagctl toggle 8
bind = $mainMod CTRL, 9, exec, hyprtagctl toggle 9

# Restore previous tags
bind = $mainMod, Escape, exec, hyprtagctl restore

# Move window to next monitor
bind = $mainMod SHIFT, N, exec, hyprtagctl move_to_next_monitor

## Original workspace bindings (commented out for reference)
## Workspaces
#bind = $mainMod, 1, workspace, 1
#bind = $mainMod, 2, workspace, 2
#bind = $mainMod, 3, workspace, 3
#bind = $mainMod, 4, workspace, 4
#bind = $mainMod, 5, workspace, 5
#bind = $mainMod, 6, workspace, 6
#bind = $mainMod, 7, workspace, 7
#bind = $mainMod, 8, workspace, 8
#bind = $mainMod, 9, workspace, 9
#bind = $mainMod, 0, workspace, 10
#
## Move to workspace (without following)
#bind = $mainMod SHIFT, 1, movetoworkspacesilent, 1
#bind = $mainMod SHIFT, 2, movetoworkspacesilent, 2
#bind = $mainMod SHIFT, 3, movetoworkspacesilent, 3
#bind = $mainMod SHIFT, 4, movetoworkspacesilent, 4
#bind = $mainMod SHIFT, 5, movetoworkspacesilent, 5
#bind = $mainMod SHIFT, 6, movetoworkspacesilent, 6
#bind = $mainMod SHIFT, 7, movetoworkspacesilent, 7
#bind = $mainMod SHIFT, 8, movetoworkspacesilent, 8
#bind = $mainMod SHIFT, 9, movetoworkspacesilent, 9
#bind = $mainMod SHIFT, 0, movetoworkspacesilent, 10

# Workspace navigation
bind = $mainMod, Prior, workspace, e-1
bind = $mainMod, Next, workspace, e+1
bind = $mainMod, Tab, workspace, previous
bind = $mainMod CTRL, Right, workspace, e+1
bind = $mainMod CTRL, Left, workspace, e-1

# Move workspace to monitor
bind = $mainMod SHIFT, X, movecurrentworkspacetomonitor, +1

# Fullscreen
bind = $mainMod, F, fullscreen, 0

# Floating
bind = $mainMod SHIFT, Space, togglefloating
bind = $mainMod, Space, cyclenext  # focus between tiling/floating

# Split direction (like i3's split h/v)
bind = $mainMod CTRL, H, layoutmsg, preselect d
bind = $mainMod CTRL, V, layoutmsg, preselect r

# Scratchpad (special workspace)
bind = $mainMod, Minus, togglespecialworkspace, scratchpad
bind = $mainMod SHIFT, Minus, movetoworkspace, special:scratchpad

# Notion Calendar (special:cal)
bindd = $mainMod ALT, C, Notion Calendar, exec, hypr-focus-or-launch -s cal "^chrome-hohliobclbfkanbfjiklibhlepflhmbf" "gtk-launch chrome-hohliobclbfkanbfjiklibhlepflhmbf-Default"
windowrule = workspace special:cal, class:^(chrome-hohliobclbfkanbfjiklibhlepflhmbf.*)$

# Gather (special:gather)
bindd = $mainMod ALT, G, Gather, exec, hypr-focus-or-launch -s gather "^chrome-ekkgfahjgapfldoebpeoimefnlikpcne" "gtk-launch chrome-ekkgfahjgapfldoebpeoimefnlikpcne-Profile_1"
windowrule = workspace special:gather, class:^(chrome-ekkgfahjgapfldoebpeoimefnlikpcne.*)$

# Parent/child focus (Hyprland doesn't have this exactly, but grouping exists)
bind = $mainMod, P, togglegroup
bind = $mainMod, C, changegroupactive

# Apps
bindd = $mainMod SHIFT, W, Browser, exec, $browser
#bindd = $mainMod SHIFT, I, Slack, exec, slack
#bindd = $mainMod SHIFT, C, Calendar, exec, notion-calendar-electron
bindd = $mainMod SHIFT, O, Obsidian, exec, obsidian

# Screenshot
bindd = , Print, Screenshot to Desktop, exec, grim -g "$(slurp)" ~/Desktop/$(date +%Y%m%d%H%M%S).png && $fileManager ~/Desktop/
bindd = CTRL, Print, Screenshot to clipboard, exec, grim -g "$(slurp)" - | wl-copy

# Switch display
bind = , XF86Display, exec, ~/.local/bin/wl-toggle-display.sh

# Notification (mako)
bindd = $mainMod CTRL, Period, Notification actions, exec, makoctl menu rofi -dmenu
bindd = $mainMod CTRL, Comma, Restore notification, exec, makoctl restore
bindd = $mainMod CTRL, C, Dismiss notifications, exec, makoctl dismiss -a

# Clipboard history
bindd = CTRL, semicolon, Clipboard history, exec, hypr-clipse

# Reload config
bindd = $mainMod SHIFT, R, Reload Hyprland config, exec, hyprctl reload

# Keybindings help
bindd = $mainMod SHIFT, Slash, Keybindings help, exec, rofi-keybindings

# Mouse bindings
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Media keys
bindel = , XF86AudioRaiseVolume, exec, wpctl set-volume -l 1 @DEFAULT_AUDIO_SINK@ 5%+
bindel = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindel = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindel = , XF86MonBrightnessUp, exec, brightnessctl -e4 -n2 set 5%+
bindel = , XF86MonBrightnessDown, exec, brightnessctl -e4 -n2 set 5%-
bindl = , XF86AudioNext, exec, playerctl next
bindl = , XF86AudioPause, exec, playerctl play-pause
bindl = , XF86AudioPlay, exec, playerctl play-pause
bindl = , XF86AudioPrev, exec, playerctl previous


#####################
### RESIZE SUBMAP ###
#####################

bind = $mainMod, R, submap, resize

submap = resize
binde = , H, resizeactive, -10% 0
binde = , J, resizeactive, 0 10%
binde = , K, resizeactive, 0 -10%
binde = , L, resizeactive, 10% 0
binde = , Left, resizeactive, -10% 0
binde = , Down, resizeactive, 0 10%
binde = , Up, resizeactive, 0 -10%
binde = , Right, resizeactive, 10% 0
bind = , Return, submap, reset
bind = , Escape, submap, reset
submap = reset


######################
### SYSTEM / POWER ###
######################

bindd = $mainMod SHIFT, E, Power menu, exec, rofi-powermenu


##############################
### WINDOW RULES ###
##############################

# Force focus on new windows
windowrule = focusonactivate, class:.*

# Floating rules
windowrule = noborder, floating:1
windowrule = noshadow, floating:1

# Chrome PWA floating window fix
windowrule = opaque, class:^(google-chrome)$, floating:1
windowrule = forcergbx, class:^(google-chrome)$, floating:1
windowrule = float, class:^(pop-up|task_dialog|dialog|menu)$
windowrule = float, title:^(About|Organizer|toolbox|page-info|webconsole)$
windowrule = float, class:^(Zeal)$
windowrule = float, class:^(GoldenDict)$
windowrule = float, class:^(copyq)$
windowrule = float, class:^(Pavumeter)$
windowrule = float, class:^(Around)$
windowrule = pin, class:^(Around)$

# Picture in Picture
windowrule = float, title:^(Picture-in-Picture)$
windowrule = pin, title:^(Picture-in-Picture)$

# Workspace assignments
windowrule = workspace 9, class:^(discord)$
windowrule = workspace 9, class:^(notion-calendar-electron)$
windowrule = workspace 7, class:^(Spotify)$
windowrule = workspace 6, class:^(obsidian)$

# Suppress maximize
windowrule = suppressevent maximize, class:.*

# XWayland fix
windowrule = nofocus, class:^$, title:^$, xwayland:1, floating:1, fullscreen:0, pinned:0

# TUI apps
windowrule = float, class:(clipse)
windowrule = size 622 652, class:(clipse)
windowrule = stayfocused, class:(clipse)

windowrule = float, class:(wiremix)
windowrule = size 622 652, class:(wiremix)

windowrule = float, class:(bluetui)
windowrule = size 622 652, class:(bluetui)
