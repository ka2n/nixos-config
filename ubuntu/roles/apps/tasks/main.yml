---
# Desktop applications installation

# Browsers
- name: Install Firefox
  apt:
    name: firefox
    state: present
  become: yes

- name: Install Google Chrome
  block:
    - name: Download Google Chrome GPG key
      shell: |
        curl -fsSL https://dl.google.com/linux/linux_signing_key.pub | gpg --dearmor -o /usr/share/keyrings/google-chrome.gpg
      args:
        creates: /usr/share/keyrings/google-chrome.gpg
      become: yes

    - name: Add Google Chrome repository
      apt_repository:
        repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/google-chrome.gpg] http://dl.google.com/linux/chrome/deb/ stable main"
        state: present
        filename: google-chrome
      become: yes

    - name: Install Google Chrome
      apt:
        name: google-chrome-stable
        state: present
        update_cache: yes
      become: yes

- name: Install Microsoft Edge
  block:
    - name: Download Microsoft GPG key
      shell: |
        curl -fsSL https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor -o /usr/share/keyrings/microsoft.gpg
      args:
        creates: /usr/share/keyrings/microsoft.gpg
      become: yes

    - name: Add Microsoft Edge repository
      apt_repository:
        repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/microsoft.gpg] https://packages.microsoft.com/repos/edge stable main"
        state: present
        filename: microsoft-edge
      become: yes

    - name: Install Microsoft Edge
      apt:
        name: microsoft-edge-stable
        state: present
        update_cache: yes
      become: yes

# Communication
- name: Install Slack
  snap:
    name: slack
    classic: yes
  become: yes

# Note-taking
- name: Install Obsidian
  vars:
    obsidian_version: "1.10.6"
  block:
    - name: Download Obsidian AppImage
      get_url:
        url: "https://github.com/obsidianmd/obsidian-releases/releases/download/v{{ obsidian_version }}/Obsidian-{{ obsidian_version }}.AppImage"
        dest: /opt/Obsidian.AppImage
        mode: '0755'
      become: yes

    - name: Create Obsidian desktop entry
      copy:
        dest: /usr/share/applications/obsidian.desktop
        content: |
          [Desktop Entry]
          Name=Obsidian
          Exec=/opt/Obsidian.AppImage
          Terminal=false
          Type=Application
          Icon=obsidian
          Categories=Office;
        mode: '0644'
      become: yes

# Office
- name: Install LibreOffice
  apt:
    name:
      - libreoffice
      - libreoffice-gtk3
    state: present
  become: yes

# File manager
- name: Install Thunar file manager
  apt:
    name:
      - thunar
      - thunar-archive-plugin
      - thunar-media-tags-plugin
      - thunar-volman
    state: present
  become: yes

# Media
- name: Install VLC media player
  apt:
    name: vlc
    state: present
  become: yes

- name: Install feh image viewer
  apt:
    name: feh
    state: present
  become: yes

- name: Install Spotify
  snap:
    name: spotify
    state: present
  become: yes

# System utilities
- name: Install Bluetooth manager
  apt:
    name:
      - blueman
      - bluez
      - bluez-tools
    state: present
  become: yes

- name: Install PulseAudio/PipeWire controls
  apt:
    name:
      - pavucontrol
      - pulsemixer
    state: present
  become: yes

- name: Install Tailscale
  block:
    - name: Add Tailscale apt key
      get_url:
        url: "{{ tailscale_apt_key_url }}"
        dest: /usr/share/keyrings/tailscale-archive-keyring.gpg
      become: yes

    - name: Add Tailscale repository
      apt_repository:
        repo: "{{ tailscale_apt_repo }}"
        state: present
        filename: tailscale
      become: yes

    - name: Install Tailscale
      apt:
        name: tailscale
        state: present
        update_cache: yes
      become: yes

    - name: Enable Tailscale service
      systemd:
        name: tailscaled
        enabled: yes
        state: started
      become: yes

# GUI Settings tools
- name: Install cameractrls (webcam settings) via snap
  snap:
    name: cameractrls
  become: yes
  ignore_errors: yes

# Keyboard and input tools
- name: Install xremap
  block:
    - name: Download xremap binary
      get_url:
        url: https://github.com/k0kubun/xremap/releases/latest/download/xremap-linux-x86_64-gnome.zip
        dest: /tmp/xremap.zip
      become: no

    - name: Extract xremap
      unarchive:
        src: /tmp/xremap.zip
        dest: /usr/local/bin/
        remote_src: yes
        mode: '0755'
      become: yes
      args:
        creates: /usr/local/bin/xremap

# Additional utilities
- name: Install additional CLI tools
  apt:
    name:
      - just      # task runner
      - peco      # interactive filtering
    state: present
  become: yes
  ignore_errors: yes
